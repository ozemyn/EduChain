# 教育知识共享平台（EduChain）数据库设计文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 项目名称 | 基于区块链存证的教育知识共享与智能检索系统（EduChain） |
| 数据库类型 | MySQL 8.0+ |
| 字符集 | utf8mb4 |
| 排序规则 | utf8mb4_unicode_ci |
| 数据库名称 | educhain_db |
| 版本 | 3.0 |
| 创建时间 | 2025-11-28 |
| 数据表数量 | 20张 |

---

## 一、数据库概述

### 1.1 系统简介

本数据库为"基于区块链存证的教育知识共享与智能检索系统"提供数据存储支持，该系统是一个面向教育领域的知识分享与学习社区。系统支持用户上传、分享、搜索各类教育资源，并提供社交互动、成就系统、内容管理等功能。

### 1.2 设计原则

1. **规范化设计**：遵循第三范式（3NF），减少数据冗余
2. **完整性约束**：通过主键、外键、唯一约束保证数据完整性
3. **性能优化**：合理设计索引，支持高效查询
4. **可扩展性**：预留扩展字段，支持业务发展
5. **安全性**：敏感数据加密存储，支持审计追踪

### 1.3 数据库架构图


```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           EduChain 数据库架构                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌─────────────────┐     ┌─────────────────┐           │
│  │   用户模块   │     │    内容模块      │     │    搜索模块      │           │
│  ├─────────────┤     ├─────────────────┤     ├─────────────────┤           │
│  │ users       │────▶│ knowledge_items │◀────│ search_indexes  │           │
│  │ user_stats  │     │ knowledge_stats │     │ search_history  │           │
│  │ user_follows│     │ knowledge_vers. │     │ hot_keywords    │           │
│  │ user_achiev.│     │ categories      │     └─────────────────┘           │
│  └─────────────┘     │ tags            │                                   │
│         │            │ file_uploads    │     ┌─────────────────┐           │
│         │            └─────────────────┘     │    外部数据模块   │           │
│         │                    │               ├─────────────────┤           │
│         ▼                    ▼               │ external_sources│           │
│  ┌─────────────┐     ┌─────────────────┐     │ external_content│           │
│  │   互动模块   │     │    通知模块      │     └─────────────────┘           │
│  ├─────────────┤     ├─────────────────┤                                   │
│  │ user_inter. │     │ notifications   │     ┌─────────────────┐           │
│  │ comments    │     └─────────────────┘     │    日志模块      │           │
│  └─────────────┘                             ├─────────────────┤           │
│                                              │ admin_logs      │           │
│                                              │ system_logs     │           │
│                                              └─────────────────┘           │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 二、数据表总览

| 序号 | 表名 | 中文名称 | 说明 | 记录预估 |
|------|------|----------|------|----------|
| 1 | users | 用户信息表 | 存储用户基本信息 | 万级 |
| 2 | categories | 分类表 | 知识内容分类（支持层级） | 百级 |
| 3 | knowledge_items | 知识条目表 | 核心内容存储表 | 十万级 |
| 4 | tags | 标签表 | 内容标签管理 | 千级 |
| 5 | comments | 评论表 | 用户评论（支持嵌套） | 十万级 |
| 6 | user_interactions | 用户互动表 | 点赞、收藏、浏览记录 | 百万级 |
| 7 | user_follows | 用户关注表 | 用户关注关系 | 万级 |
| 8 | notifications | 通知表 | 系统通知与消息 | 十万级 |
| 9 | knowledge_versions | 知识版本历史表 | 内容版本控制 | 十万级 |
| 10 | knowledge_stats | 知识统计表 | 内容统计数据 | 十万级 |
| 11 | user_stats | 用户统计表 | 用户行为统计 | 万级 |
| 12 | user_achievements | 用户成就表 | 成就与徽章系统 | 万级 |
| 13 | search_history | 搜索历史表 | 搜索行为记录 | 百万级 |
| 14 | search_indexes | 搜索索引表 | 全文搜索优化 | 十万级 |
| 15 | hot_keywords | 热门关键词表 | 热搜词统计 | 千级 |
| 16 | file_uploads | 文件上传表 | 文件资源管理 | 十万级 |
| 17 | external_sources | 外部数据源表 | 爬虫数据源配置 | 百级 |
| 18 | external_contents | 外部内容表 | 爬取的外部内容 | 万级 |
| 19 | admin_logs | 管理员日志表 | 管理操作审计 | 万级 |
| 20 | system_logs | 系统日志表 | 系统运行日志 | 百万级 |

---

## 三、数据表详细设计


### 3.1 用户信息表（users）

**表说明**：存储平台用户的基本信息，包括账号、密码、个人资料等。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 用户唯一标识 |
| username | VARCHAR(50) | NOT NULL, UNIQUE | - | 用户名 |
| email | VARCHAR(100) | NOT NULL, UNIQUE | - | 邮箱地址 |
| password_hash | VARCHAR(255) | NOT NULL | - | 加密后的密码 |
| role | ENUM | NOT NULL | 'LEARNER' | 用户角色（LEARNER/ADMIN） |
| full_name | VARCHAR(100) | - | NULL | 真实姓名 |
| avatar_url | VARCHAR(500) | - | NULL | 头像URL |
| school | VARCHAR(100) | - | NULL | 学校信息 |
| level | INT | NOT NULL | 1 | 用户等级 |
| bio | TEXT | - | NULL | 个人简介 |
| status | INT | NOT NULL | 1 | 状态（1-正常，0-禁用） |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

**索引设计**：
- `idx_username`：用户名索引，加速登录查询
- `idx_email`：邮箱索引，加速邮箱验证
- `idx_status`：状态索引，加速用户筛选

---

### 3.2 分类表（categories）

**表说明**：存储知识内容的分类信息，支持无限层级的树形结构。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 分类唯一标识 |
| name | VARCHAR(100) | NOT NULL, UNIQUE | - | 分类名称 |
| description | TEXT | - | NULL | 分类描述 |
| parent_id | BIGINT | FOREIGN KEY | NULL | 父分类ID |
| sort_order | INT | NOT NULL | 0 | 排序序号 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**外键关系**：
- `parent_id` → `categories(id)` ON DELETE SET NULL

**索引设计**：
- `idx_name`：分类名称索引
- `idx_parent_id`：父分类索引，加速层级查询
- `idx_sort_order`：排序索引

---

### 3.3 知识条目表（knowledge_items）

**表说明**：核心业务表，存储用户上传的知识内容，支持多种内容类型。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 知识条目唯一标识 |
| share_code | VARCHAR(32) | NOT NULL, UNIQUE | - | 分享码（Base58编码） |
| title | VARCHAR(200) | NOT NULL | - | 标题 |
| content | LONGTEXT | - | NULL | 内容正文 |
| type | ENUM | NOT NULL | 'TEXT' | 内容类型 |
| media_urls | JSON | - | NULL | 多媒体URL集合 |
| link_url | VARCHAR(500) | - | NULL | 外部链接 |
| uploader_id | BIGINT | NOT NULL, FOREIGN KEY | - | 上传者ID |
| category_id | BIGINT | NOT NULL, FOREIGN KEY | - | 分类ID |
| tags | VARCHAR(500) | - | NULL | 标签（逗号分隔） |
| status | INT | NOT NULL | 1 | 状态（1-正常，0-删除，2-草稿） |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

**内容类型枚举**：
- `TEXT`：纯文本
- `IMAGE`：图片
- `VIDEO`：视频
- `DOCUMENT`：文档
- `LINK`：链接
- `MIXED`：混合类型

**外键关系**：
- `uploader_id` → `users(id)` ON DELETE CASCADE
- `category_id` → `categories(id)` ON DELETE CASCADE

**索引设计**：
- `idx_share_code`：分享码索引，支持快速分享访问
- `idx_title`：标题索引，支持标题搜索
- `idx_uploader_id`：上传者索引
- `idx_category_id`：分类索引
- `idx_type`：类型索引
- `idx_status`：状态索引
- `idx_created_at`：创建时间索引
- `idx_tags`：标签索引
- `idx_knowledge_status_created`：复合索引（状态+创建时间）

---


### 3.4 标签表（tags）

**表说明**：存储系统中的标签信息，支持标签分类和使用统计。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 标签唯一标识 |
| name | VARCHAR(50) | NOT NULL, UNIQUE | - | 标签名称 |
| description | VARCHAR(200) | - | NULL | 标签描述 |
| usage_count | BIGINT | NOT NULL | 0 | 使用次数 |
| category | VARCHAR(50) | - | NULL | 标签分类 |
| color | VARCHAR(20) | - | NULL | 标签颜色 |
| status | INT | NOT NULL | 1 | 状态（1-正常，0-禁用） |
| creator_id | BIGINT | FOREIGN KEY | NULL | 创建者ID |
| last_used_at | DATETIME | - | NULL | 最后使用时间 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

---

### 3.5 评论表（comments）

**表说明**：存储用户对知识内容的评论，支持嵌套回复。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 评论唯一标识 |
| knowledge_id | BIGINT | NOT NULL, FOREIGN KEY | - | 知识条目ID |
| user_id | BIGINT | NOT NULL, FOREIGN KEY | - | 用户ID |
| parent_id | BIGINT | FOREIGN KEY | NULL | 父评论ID（支持嵌套） |
| content | TEXT | NOT NULL | - | 评论内容 |
| status | INT | NOT NULL | 1 | 状态（1-正常，0-删除，2-待审核） |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**外键关系**：
- `knowledge_id` → `knowledge_items(id)` ON DELETE CASCADE
- `user_id` → `users(id)` ON DELETE CASCADE
- `parent_id` → `comments(id)` ON DELETE CASCADE

---

### 3.6 用户互动表（user_interactions）

**表说明**：记录用户与知识内容的互动行为，包括点赞、收藏、浏览。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 互动记录唯一标识 |
| knowledge_id | BIGINT | NOT NULL, FOREIGN KEY | - | 知识条目ID |
| user_id | BIGINT | NOT NULL, FOREIGN KEY | - | 用户ID |
| interaction_type | ENUM | NOT NULL | - | 互动类型（LIKE/FAVORITE/VIEW） |
| ip_address | VARCHAR(45) | - | NULL | IP地址 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**唯一约束**：
- `uk_user_knowledge_interaction`：(user_id, knowledge_id, interaction_type) 防止重复互动

---

### 3.7 用户关注表（user_follows）

**表说明**：存储用户之间的关注关系。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 关注记录唯一标识 |
| follower_id | BIGINT | NOT NULL, FOREIGN KEY | - | 关注者ID |
| following_id | BIGINT | NOT NULL, FOREIGN KEY | - | 被关注者ID |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**唯一约束**：
- `uk_follower_following`：(follower_id, following_id) 防止重复关注

---

### 3.8 通知表（notifications）

**表说明**：存储系统通知和用户消息。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 通知唯一标识 |
| user_id | BIGINT | NOT NULL, FOREIGN KEY | - | 接收用户ID |
| type | ENUM | NOT NULL | - | 通知类型 |
| title | VARCHAR(200) | NOT NULL | - | 通知标题 |
| content | TEXT | NOT NULL | - | 通知内容 |
| related_id | BIGINT | - | NULL | 关联ID |
| related_user_id | BIGINT | - | NULL | 相关用户ID |
| is_read | TINYINT(1) | NOT NULL | 0 | 是否已读（0-未读，1-已读） |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**通知类型枚举**：
- `LIKE`：点赞通知
- `COMMENT`：评论通知
- `REPLY`：回复通知
- `FOLLOW`：关注通知
- `SYSTEM`：系统通知

---


### 3.9 知识版本历史表（knowledge_versions）

**表说明**：记录知识内容的版本变更历史，支持版本回溯。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 版本记录唯一标识 |
| knowledge_id | BIGINT | NOT NULL, FOREIGN KEY | - | 知识条目ID |
| version_number | INT | NOT NULL | - | 版本号 |
| title | VARCHAR(200) | NOT NULL | - | 历史标题 |
| content | LONGTEXT | - | NULL | 内容快照 |
| type | ENUM | NOT NULL | - | 内容类型 |
| media_urls | JSON | - | NULL | 多媒体URL集合 |
| link_url | VARCHAR(500) | - | NULL | 外部链接 |
| tags | VARCHAR(500) | - | NULL | 标签 |
| editor_id | BIGINT | NOT NULL, FOREIGN KEY | - | 编辑者ID |
| change_summary | VARCHAR(500) | - | NULL | 变更摘要 |
| change_type | ENUM | NOT NULL | 'UPDATE' | 变更类型 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**变更类型枚举**：
- `CREATE`：创建
- `UPDATE`：更新
- `DELETE`：删除
- `RESTORE`：恢复

---

### 3.10 知识统计表（knowledge_stats）

**表说明**：存储知识内容的统计数据，与知识条目一对一关联。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 统计记录唯一标识 |
| knowledge_id | BIGINT | NOT NULL, UNIQUE, FOREIGN KEY | - | 知识条目ID |
| view_count | BIGINT | NOT NULL | 0 | 浏览次数 |
| like_count | BIGINT | NOT NULL | 0 | 点赞次数 |
| favorite_count | BIGINT | NOT NULL | 0 | 收藏次数 |
| comment_count | BIGINT | NOT NULL | 0 | 评论次数 |
| share_count | BIGINT | NOT NULL | 0 | 分享次数 |
| quality_score | DOUBLE | - | 0.0 | 质量评分 |
| last_view_at | DATETIME | - | NULL | 最后浏览时间 |
| last_interaction_at | DATETIME | - | NULL | 最后互动时间 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

---

### 3.11 用户统计表（user_stats）

**表说明**：存储用户的统计数据，与用户表一对一关联。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 统计记录唯一标识 |
| user_id | BIGINT | NOT NULL, UNIQUE, FOREIGN KEY | - | 用户ID |
| knowledge_count | INT | NOT NULL | 0 | 知识内容数量 |
| like_count | INT | NOT NULL | 0 | 获得点赞数量 |
| favorite_count | INT | NOT NULL | 0 | 获得收藏数量 |
| comment_count | INT | NOT NULL | 0 | 评论数量 |
| follower_count | INT | NOT NULL | 0 | 粉丝数量 |
| following_count | INT | NOT NULL | 0 | 关注数量 |
| view_count | BIGINT | NOT NULL | 0 | 内容被浏览量 |
| total_score | INT | NOT NULL | 0 | 总积分 |
| achievement_count | INT | NOT NULL | 0 | 成就数量 |
| login_count | INT | NOT NULL | 0 | 登录次数 |
| last_login_at | DATETIME | - | NULL | 最后登录时间 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

---

### 3.12 用户成就表（user_achievements）

**表说明**：存储用户获得的成就和徽章信息。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 成就记录唯一标识 |
| user_id | BIGINT | NOT NULL, FOREIGN KEY | - | 用户ID |
| achievement_type | ENUM | NOT NULL | - | 成就类型 |
| achievement_name | VARCHAR(100) | NOT NULL | - | 成就名称 |
| achievement_description | TEXT | - | NULL | 成就描述 |
| achievement_icon | VARCHAR(200) | - | NULL | 成就图标 |
| points_awarded | INT | NOT NULL | 0 | 成就积分 |
| level | INT | NOT NULL | 1 | 成就等级 |
| progress_current | INT | NOT NULL | 0 | 当前进度 |
| progress_target | INT | NOT NULL | 1 | 目标进度 |
| is_completed | TINYINT(1) | NOT NULL | 0 | 是否完成 |
| achieved_at | DATETIME | - | NULL | 获得时间 |
| metadata | JSON | - | NULL | 额外数据 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

**成就类型枚举**：
- `KNOWLEDGE_CREATOR`：知识创作者
- `KNOWLEDGE_SHARER`：知识分享者
- `ACTIVE_LEARNER`：活跃学习者
- `SOCIAL_BUTTERFLY`：社交达人
- `QUALITY_CONTRIBUTOR`：优质贡献者
- `MILESTONE_ACHIEVER`：里程碑达成者
- `SPECIAL_EVENT`：特殊活动
- `SYSTEM_BADGE`：系统徽章

---


### 3.13 搜索历史表（search_history）

**表说明**：记录用户的搜索行为，用于搜索分析和个性化推荐。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 搜索记录唯一标识 |
| user_id | BIGINT | - | NULL | 用户ID（支持匿名搜索） |
| keyword | VARCHAR(100) | NOT NULL | - | 搜索关键词 |
| result_count | BIGINT | NOT NULL | 0 | 搜索结果数量 |
| category_id | BIGINT | - | NULL | 分类ID |
| content_type | ENUM | - | NULL | 内容类型筛选 |
| ip_address | VARCHAR(45) | - | NULL | IP地址 |
| user_agent | VARCHAR(500) | - | NULL | 用户代理 |
| search_time | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 搜索时间 |
| response_time | BIGINT | - | NULL | 响应时间（毫秒） |
| clicked_result_id | BIGINT | - | NULL | 点击的结果ID |
| clicked_position | INT | - | NULL | 点击位置 |
| session_id | VARCHAR(100) | - | NULL | 会话ID |

---

### 3.14 搜索索引表（search_indexes）

**表说明**：存储知识内容的搜索索引，优化全文搜索性能。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 索引记录唯一标识 |
| knowledge_id | BIGINT | NOT NULL, UNIQUE, FOREIGN KEY | - | 知识条目ID |
| search_text | TEXT | - | NULL | 合并的搜索文本 |
| title | VARCHAR(200) | - | NULL | 标题 |
| content_summary | VARCHAR(500) | - | NULL | 内容摘要 |
| category_id | BIGINT | - | NULL | 分类ID |
| category_name | VARCHAR(100) | - | NULL | 分类名称 |
| tags | VARCHAR(500) | - | NULL | 标签 |
| uploader_id | BIGINT | - | NULL | 上传者ID |
| uploader_name | VARCHAR(50) | - | NULL | 上传者名称 |
| content_type | ENUM | - | NULL | 内容类型 |
| view_count | BIGINT | NOT NULL | 0 | 浏览量 |
| like_count | BIGINT | NOT NULL | 0 | 点赞数 |
| favorite_count | BIGINT | NOT NULL | 0 | 收藏数 |
| comment_count | BIGINT | NOT NULL | 0 | 评论数 |
| quality_score | DOUBLE | NOT NULL | 0.0 | 质量评分 |
| status | INT | NOT NULL | 1 | 状态 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

---

### 3.15 热门关键词表（hot_keywords）

**表说明**：存储热门搜索关键词及其统计数据。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 关键词唯一标识 |
| keyword | VARCHAR(100) | NOT NULL, UNIQUE | - | 关键词 |
| search_count | BIGINT | NOT NULL | 0 | 总搜索次数 |
| result_count | BIGINT | NOT NULL | 0 | 搜索结果数量 |
| click_count | BIGINT | NOT NULL | 0 | 点击次数 |
| trend_score | DOUBLE | NOT NULL | 0.0 | 趋势分数 |
| daily_count | BIGINT | NOT NULL | 0 | 今日搜索次数 |
| weekly_count | BIGINT | NOT NULL | 0 | 本周搜索次数 |
| monthly_count | BIGINT | NOT NULL | 0 | 本月搜索次数 |
| last_searched_at | DATETIME | - | NULL | 最后搜索时间 |
| category_id | BIGINT | - | NULL | 关联分类ID |
| category_name | VARCHAR(100) | - | NULL | 分类名称 |
| status | INT | NOT NULL | 1 | 状态 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

---

### 3.16 文件上传表（file_uploads）

**表说明**：管理用户上传的文件资源。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 文件唯一标识 |
| original_name | VARCHAR(255) | NOT NULL | - | 原始文件名 |
| stored_name | VARCHAR(255) | NOT NULL | - | 存储文件名 |
| file_path | VARCHAR(500) | NOT NULL | - | 文件路径 |
| file_url | VARCHAR(500) | NOT NULL | - | 文件URL |
| file_size | BIGINT | NOT NULL | - | 文件大小（字节） |
| file_type | VARCHAR(100) | NOT NULL | - | 文件类型 |
| mime_type | VARCHAR(100) | - | NULL | MIME类型 |
| file_hash | VARCHAR(64) | - | NULL | 文件哈希值 |
| uploader_id | BIGINT | NOT NULL, FOREIGN KEY | - | 上传者ID |
| knowledge_id | BIGINT | FOREIGN KEY | NULL | 关联知识内容ID |
| download_count | BIGINT | NOT NULL | 0 | 下载次数 |
| last_accessed_at | DATETIME | - | NULL | 最后访问时间 |
| status | INT | NOT NULL | 1 | 状态 |
| description | VARCHAR(500) | - | NULL | 文件描述 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

---


### 3.17 外部数据源表（external_sources）

**表说明**：配置外部数据爬取源，支持定时抓取外部教育资源。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 数据源唯一标识 |
| name | VARCHAR(100) | NOT NULL | - | 数据源名称 |
| source_url | VARCHAR(500) | NOT NULL, UNIQUE | - | 数据源URL |
| source_type | VARCHAR(50) | NOT NULL | - | 数据源类型 |
| description | TEXT | - | NULL | 描述 |
| crawl_frequency | INT | NOT NULL | 24 | 抓取频率（小时） |
| selector_config | JSON | - | NULL | CSS选择器配置 |
| headers_config | JSON | - | NULL | HTTP请求头配置 |
| status | INT | NOT NULL | 1 | 状态（1-启用，0-禁用） |
| last_crawl_at | DATETIME | - | NULL | 最后抓取时间 |
| last_success_at | DATETIME | - | NULL | 最后成功时间 |
| last_error | TEXT | - | NULL | 最后错误信息 |
| total_crawled | BIGINT | NOT NULL | 0 | 总抓取次数 |
| total_success | BIGINT | NOT NULL | 0 | 总成功次数 |
| total_failed | BIGINT | NOT NULL | 0 | 总失败次数 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

---

### 3.18 外部内容表（external_contents）

**表说明**：存储从外部数据源抓取的内容。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 外部内容唯一标识 |
| source_id | BIGINT | NOT NULL, FOREIGN KEY | - | 数据源ID |
| title | VARCHAR(200) | NOT NULL | - | 标题 |
| content | LONGTEXT | - | NULL | 内容 |
| summary | TEXT | - | NULL | 摘要 |
| author | VARCHAR(100) | - | NULL | 作者 |
| original_url | VARCHAR(500) | NOT NULL | - | 原始URL |
| image_url | VARCHAR(500) | - | NULL | 图片URL |
| tags | VARCHAR(500) | - | NULL | 标签 |
| category | VARCHAR(100) | - | NULL | 分类 |
| content_hash | VARCHAR(64) | NOT NULL, UNIQUE | - | 内容哈希（去重） |
| language | VARCHAR(10) | - | 'zh' | 语言 |
| word_count | INT | - | NULL | 字数 |
| reading_time | INT | - | NULL | 预估阅读时间（分钟） |
| status | INT | NOT NULL | 1 | 状态 |
| quality_score | DOUBLE | - | 0.0 | 质量分数 |
| published_at | DATETIME | - | NULL | 发布时间 |
| crawled_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 抓取时间 |
| last_updated_at | DATETIME | - | NULL | 最后更新时间 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |

---

### 3.19 管理员日志表（admin_logs）

**表说明**：记录管理员的操作日志，用于审计追踪。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 日志唯一标识 |
| admin_id | BIGINT | NOT NULL | - | 管理员ID |
| admin_username | VARCHAR(50) | NOT NULL | - | 管理员用户名 |
| operation_type | ENUM | NOT NULL | - | 操作类型 |
| target_type | ENUM | NOT NULL | - | 目标类型 |
| target_id | BIGINT | - | NULL | 操作对象ID |
| target_name | VARCHAR(200) | - | NULL | 操作对象名称 |
| operation | VARCHAR(200) | NOT NULL | - | 操作描述 |
| description | TEXT | - | NULL | 详细描述 |
| old_value | TEXT | - | NULL | 旧值 |
| new_value | TEXT | - | NULL | 新值 |
| ip_address | VARCHAR(45) | - | NULL | IP地址 |
| user_agent | VARCHAR(500) | - | NULL | 用户代理 |
| result | ENUM | NOT NULL | - | 操作结果 |
| error_message | TEXT | - | NULL | 错误信息 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**操作类型枚举**：CREATE, UPDATE, DELETE, APPROVE, REJECT, DISABLE, ENABLE, EXPORT, IMPORT, BACKUP, RESTORE

**目标类型枚举**：USER, KNOWLEDGE_ITEM, CATEGORY, COMMENT, TAG, SYSTEM_CONFIG, EXTERNAL_SOURCE, NOTIFICATION, LOG

**操作结果枚举**：SUCCESS, FAILED, PARTIAL

---

### 3.20 系统日志表（system_logs）

**表说明**：记录系统运行日志，包括操作日志、错误日志、安全日志等。

| 字段名 | 数据类型 | 约束 | 默认值 | 说明 |
|--------|----------|------|--------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | - | 日志唯一标识 |
| log_type | ENUM | NOT NULL | - | 日志类型 |
| level | ENUM | NOT NULL | - | 日志级别 |
| user_id | BIGINT | FOREIGN KEY | NULL | 用户ID |
| username | VARCHAR(100) | - | NULL | 用户名 |
| operation | VARCHAR(200) | NOT NULL | - | 操作 |
| description | TEXT | - | NULL | 描述 |
| ip_address | VARCHAR(45) | - | NULL | IP地址 |
| user_agent | VARCHAR(500) | - | NULL | 用户代理 |
| request_url | VARCHAR(500) | - | NULL | 请求URL |
| request_method | VARCHAR(10) | - | NULL | 请求方法 |
| response_status | INT | - | NULL | 响应状态码 |
| execution_time | BIGINT | - | NULL | 执行时间（毫秒） |
| exception | TEXT | - | NULL | 异常信息 |
| created_at | DATETIME | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

**日志类型枚举**：OPERATION, ERROR, SECURITY, PERFORMANCE, SYSTEM

**日志级别枚举**：DEBUG, INFO, WARN, ERROR, FATAL

---


## 四、数据库关系图（E-R图）

### 4.1 核心实体关系

```
                                    ┌─────────────────┐
                                    │    categories   │
                                    │   (分类表)       │
                                    └────────┬────────┘
                                             │ 1:N
                                             ▼
┌─────────────┐    1:N    ┌─────────────────────────────────┐    1:1    ┌─────────────────┐
│    users    │◀─────────▶│        knowledge_items          │◀─────────▶│ knowledge_stats │
│  (用户表)    │           │        (知识条目表)              │           │  (知识统计表)    │
└──────┬──────┘           └───────────────┬─────────────────┘           └─────────────────┘
       │                                  │
       │ 1:1                              │ 1:N
       ▼                                  ▼
┌─────────────┐                  ┌─────────────────┐
│ user_stats  │                  │ knowledge_vers. │
│(用户统计表)  │                  │  (版本历史表)    │
└─────────────┘                  └─────────────────┘
```

### 4.2 用户互动关系

```
┌─────────────┐
│    users    │
└──────┬──────┘
       │
       ├──────────────────┬──────────────────┬──────────────────┐
       │ 1:N              │ 1:N              │ 1:N              │ 1:N
       ▼                  ▼                  ▼                  ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  comments   │    │user_interact│    │ user_follows│    │notifications│
│  (评论表)    │    │ (互动表)     │    │  (关注表)    │    │  (通知表)    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │
       │ 自关联 (parent_id)
       ▼
┌─────────────┐
│  comments   │
│ (嵌套评论)   │
└─────────────┘
```

### 4.3 完整E-R图

```
                              ┌──────────────────────────────────────────────────────────────┐
                              │                        用户模块                               │
                              │  ┌─────────┐    ┌─────────────┐    ┌─────────────────┐       │
                              │  │  users  │───▶│ user_stats  │    │ user_achievements│       │
                              │  └────┬────┘    └─────────────┘    └─────────────────┘       │
                              │       │                                                      │
                              └───────┼──────────────────────────────────────────────────────┘
                                      │
        ┌─────────────────────────────┼─────────────────────────────┐
        │                             │                             │
        ▼                             ▼                             ▼
┌───────────────┐            ┌───────────────┐            ┌───────────────┐
│ user_follows  │            │   comments    │            │user_interactions│
│   (关注)       │            │    (评论)     │            │    (互动)       │
└───────────────┘            └───────┬───────┘            └───────┬───────┘
                                     │                            │
                                     └────────────┬───────────────┘
                                                  │
                                                  ▼
                              ┌──────────────────────────────────────────────────────────────┐
                              │                        内容模块                               │
                              │  ┌─────────────────┐    ┌─────────────────┐                  │
                              │  │ knowledge_items │───▶│ knowledge_stats │                  │
                              │  └────────┬────────┘    └─────────────────┘                  │
                              │           │                                                  │
                              │           ├───────────▶ knowledge_versions                   │
                              │           │                                                  │
                              │           ├───────────▶ search_indexes                       │
                              │           │                                                  │
                              │           └───────────▶ file_uploads                         │
                              │                                                              │
                              │  ┌─────────────┐    ┌─────────────┐                          │
                              │  │ categories  │    │    tags     │                          │
                              │  └─────────────┘    └─────────────┘                          │
                              └──────────────────────────────────────────────────────────────┘
```

---

## 五、触发器设计

### 5.1 用户互动统计触发器（tr_interaction_stats）

**触发时机**：在 `user_interactions` 表插入数据后触发

**功能说明**：自动更新 `knowledge_stats` 表中的统计数据

```sql
CREATE TRIGGER tr_interaction_stats AFTER INSERT ON user_interactions
FOR EACH ROW
BEGIN
    IF NEW.interaction_type = 'LIKE' THEN
        INSERT INTO knowledge_stats (knowledge_id, like_count) 
        VALUES (NEW.knowledge_id, 1)
        ON DUPLICATE KEY UPDATE like_count = like_count + 1;
    ELSEIF NEW.interaction_type = 'FAVORITE' THEN
        INSERT INTO knowledge_stats (knowledge_id, favorite_count) 
        VALUES (NEW.knowledge_id, 1)
        ON DUPLICATE KEY UPDATE favorite_count = favorite_count + 1;
    ELSEIF NEW.interaction_type = 'VIEW' THEN
        INSERT INTO knowledge_stats (knowledge_id, view_count) 
        VALUES (NEW.knowledge_id, 1)
        ON DUPLICATE KEY UPDATE view_count = view_count + 1;
    END IF;
END
```

### 5.2 评论统计触发器（tr_comment_stats）

**触发时机**：在 `comments` 表插入数据后触发

**功能说明**：自动更新 `knowledge_stats` 表中的评论计数

```sql
CREATE TRIGGER tr_comment_stats AFTER INSERT ON comments
FOR EACH ROW
BEGIN
    INSERT INTO knowledge_stats (knowledge_id, comment_count) 
    VALUES (NEW.knowledge_id, 1)
    ON DUPLICATE KEY UPDATE comment_count = comment_count + 1;
END
```

---


## 六、索引设计

### 6.1 索引设计原则

1. **主键索引**：所有表均使用自增 BIGINT 作为主键
2. **唯一索引**：对业务唯一字段建立唯一索引（如用户名、邮箱、分享码）
3. **外键索引**：所有外键字段自动创建索引
4. **查询优化索引**：针对高频查询字段建立索引
5. **复合索引**：针对多条件查询建立复合索引

### 6.2 索引清单

| 表名 | 索引名 | 索引类型 | 字段 | 说明 |
|------|--------|----------|------|------|
| users | PRIMARY | 主键 | id | 主键索引 |
| users | idx_username | 普通 | username | 用户名查询 |
| users | idx_email | 普通 | email | 邮箱查询 |
| users | idx_status | 普通 | status | 状态筛选 |
| knowledge_items | PRIMARY | 主键 | id | 主键索引 |
| knowledge_items | idx_share_code | 唯一 | share_code | 分享码查询 |
| knowledge_items | idx_title | 普通 | title | 标题搜索 |
| knowledge_items | idx_uploader_id | 普通 | uploader_id | 上传者查询 |
| knowledge_items | idx_category_id | 普通 | category_id | 分类查询 |
| knowledge_items | idx_knowledge_status_created | 复合 | status, created_at | 状态+时间排序 |
| user_interactions | uk_user_knowledge_interaction | 唯一 | user_id, knowledge_id, interaction_type | 防重复互动 |
| user_interactions | idx_interactions_knowledge_type | 复合 | knowledge_id, interaction_type | 互动统计 |
| comments | idx_comments_knowledge_created | 复合 | knowledge_id, created_at | 评论列表 |
| search_history | idx_keyword | 普通 | keyword | 关键词统计 |
| search_history | idx_search_time | 普通 | search_time | 时间范围查询 |
| hot_keywords | idx_trend_score | 普通 | trend_score | 热度排序 |

### 6.3 复合索引优化

```sql
-- 知识内容状态+时间复合索引（用于首页列表查询）
CREATE INDEX idx_knowledge_status_created ON knowledge_items(status, created_at DESC);

-- 互动记录复合索引（用于统计查询）
CREATE INDEX idx_interactions_knowledge_type ON user_interactions(knowledge_id, interaction_type);

-- 评论复合索引（用于评论列表查询）
CREATE INDEX idx_comments_knowledge_created ON comments(knowledge_id, created_at DESC);
```

---

## 七、数据字典

### 7.1 状态码定义

| 状态值 | 含义 | 适用表 |
|--------|------|--------|
| 1 | 正常/启用 | users, knowledge_items, comments, tags, external_sources 等 |
| 0 | 禁用/删除 | users, knowledge_items, comments, tags 等 |
| 2 | 草稿/待审核 | knowledge_items, comments, file_uploads |
| -1 | 永久删除 | external_contents |

### 7.2 用户角色定义

| 角色值 | 角色名称 | 权限说明 |
|--------|----------|----------|
| LEARNER | 学习者 | 普通用户，可浏览、上传、评论、互动 |
| ADMIN | 管理员 | 系统管理员，拥有所有权限 |

### 7.3 内容类型定义

| 类型值 | 类型名称 | 说明 |
|--------|----------|------|
| TEXT | 纯文本 | 文字内容 |
| IMAGE | 图片 | 图片资源 |
| VIDEO | 视频 | 视频资源 |
| DOCUMENT | 文档 | PDF、Word等文档 |
| LINK | 链接 | 外部链接 |
| MIXED | 混合 | 多种类型混合 |

### 7.4 互动类型定义

| 类型值 | 类型名称 | 说明 |
|--------|----------|------|
| LIKE | 点赞 | 用户点赞行为 |
| FAVORITE | 收藏 | 用户收藏行为 |
| VIEW | 浏览 | 用户浏览行为 |

### 7.5 通知类型定义

| 类型值 | 类型名称 | 说明 |
|--------|----------|------|
| LIKE | 点赞通知 | 内容被点赞时通知 |
| COMMENT | 评论通知 | 内容被评论时通知 |
| REPLY | 回复通知 | 评论被回复时通知 |
| FOLLOW | 关注通知 | 被关注时通知 |
| SYSTEM | 系统通知 | 系统公告等 |

### 7.6 日志级别定义

| 级别值 | 级别名称 | 说明 |
|--------|----------|------|
| DEBUG | 调试 | 调试信息 |
| INFO | 信息 | 一般信息 |
| WARN | 警告 | 警告信息 |
| ERROR | 错误 | 错误信息 |
| FATAL | 致命 | 致命错误 |

---


## 八、数据库安全设计

### 8.1 数据安全措施

1. **密码加密**：用户密码使用 BCrypt 算法加密存储于 `password_hash` 字段
2. **敏感数据保护**：IP地址、用户代理等信息用于安全审计
3. **SQL注入防护**：使用参数化查询，避免SQL注入攻击
4. **访问控制**：通过角色权限控制数据访问范围

### 8.2 数据完整性保障

1. **主键约束**：所有表使用自增主键，保证记录唯一性
2. **外键约束**：建立表间关联，保证引用完整性
3. **唯一约束**：对业务唯一字段建立唯一约束
4. **非空约束**：关键字段设置 NOT NULL 约束
5. **默认值**：为可选字段设置合理默认值

### 8.3 级联删除策略

| 主表 | 从表 | 删除策略 | 说明 |
|------|------|----------|------|
| users | knowledge_items | CASCADE | 用户删除时删除其知识内容 |
| users | comments | CASCADE | 用户删除时删除其评论 |
| users | user_interactions | CASCADE | 用户删除时删除其互动记录 |
| users | user_follows | CASCADE | 用户删除时删除关注关系 |
| users | notifications | CASCADE | 用户删除时删除其通知 |
| knowledge_items | comments | CASCADE | 知识删除时删除相关评论 |
| knowledge_items | user_interactions | CASCADE | 知识删除时删除相关互动 |
| knowledge_items | knowledge_stats | CASCADE | 知识删除时删除统计数据 |
| knowledge_items | knowledge_versions | CASCADE | 知识删除时删除版本历史 |
| categories | categories | SET NULL | 父分类删除时子分类的parent_id置空 |
| external_sources | external_contents | CASCADE | 数据源删除时删除抓取内容 |

---

## 九、性能优化建议

### 9.1 查询优化

1. **分页查询**：使用 LIMIT + OFFSET 或游标分页
2. **延迟关联**：先查询主键，再关联查询详情
3. **覆盖索引**：设计索引覆盖常用查询字段
4. **避免全表扫描**：确保 WHERE 条件使用索引

### 9.2 表结构优化

1. **垂直分表**：将大字段（如 content）与高频字段分离
2. **读写分离**：统计表与主表分离，减少锁竞争
3. **冷热分离**：历史数据归档，减少主表数据量

### 9.3 索引优化建议

```sql
-- 建议添加的优化索引

-- 用户内容列表查询优化
CREATE INDEX idx_knowledge_uploader_status ON knowledge_items(uploader_id, status, created_at DESC);

-- 分类内容查询优化
CREATE INDEX idx_knowledge_category_status ON knowledge_items(category_id, status, created_at DESC);

-- 用户收藏列表查询优化
CREATE INDEX idx_interaction_user_type ON user_interactions(user_id, interaction_type, created_at DESC);

-- 通知列表查询优化
CREATE INDEX idx_notification_user_read ON notifications(user_id, is_read, created_at DESC);
```

### 9.4 缓存策略建议

| 数据类型 | 缓存策略 | 过期时间 | 说明 |
|----------|----------|----------|------|
| 用户信息 | 读取缓存 | 30分钟 | 用户基本信息缓存 |
| 分类列表 | 全量缓存 | 1小时 | 分类数据变化少 |
| 热门内容 | 定时刷新 | 5分钟 | 首页热门列表 |
| 统计数据 | 异步更新 | 实时 | 使用消息队列异步更新 |
| 搜索结果 | 查询缓存 | 10分钟 | 相同查询条件缓存 |

---

## 十、初始化数据

### 10.1 分类初始数据

系统预置了4个根分类和12个子分类：

| 根分类 | 子分类 |
|--------|--------|
| 前端开发 | React, Vue, Angular |
| 后端开发 | Spring Boot, Node.js, Django |
| 数据库 | MySQL, Redis, MongoDB |
| 移动开发 | React Native, Flutter, iOS |

### 10.2 初始化SQL

```sql
-- 根分类
INSERT INTO categories (id, name, description, parent_id, sort_order) VALUES
(1, '前端开发', '前端相关技术', NULL, 1),
(2, '后端开发', '后端相关技术', NULL, 2),
(3, '数据库', '数据库相关技术', NULL, 3),
(4, '移动开发', '移动应用开发', NULL, 4);

-- 子分类（前端）
INSERT INTO categories (id, name, description, parent_id, sort_order) VALUES
(11, 'React', 'React框架', 1, 1),
(12, 'Vue', 'Vue框架', 1, 2),
(13, 'Angular', 'Angular框架', 1, 3);

-- 子分类（后端）
INSERT INTO categories (id, name, description, parent_id, sort_order) VALUES
(21, 'Spring Boot', 'Spring Boot框架', 2, 1),
(22, 'Node.js', 'Node.js运行时', 2, 2),
(23, 'Django', 'Django框架', 2, 3);

-- 子分类（数据库）
INSERT INTO categories (id, name, description, parent_id, sort_order) VALUES
(31, 'MySQL', 'MySQL数据库', 3, 1),
(32, 'Redis', 'Redis缓存', 3, 2),
(33, 'MongoDB', 'MongoDB文档数据库', 3, 3);

-- 子分类（移动开发）
INSERT INTO categories (id, name, description, parent_id, sort_order) VALUES
(41, 'React Native', 'React Native框架', 4, 1),
(42, 'Flutter', 'Flutter框架', 4, 2),
(43, 'iOS', 'iOS原生开发', 4, 3);
```

---


## 十一、数据库部署说明

### 11.1 环境要求

| 项目 | 要求 |
|------|------|
| 数据库版本 | MySQL 8.0+ |
| 字符集 | utf8mb4 |
| 排序规则 | utf8mb4_unicode_ci |
| 存储引擎 | InnoDB |
| 最小内存 | 2GB |
| 推荐内存 | 8GB+ |

### 11.2 部署步骤

1. **创建数据库**
```sql
CREATE DATABASE IF NOT EXISTS educhain_db 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;
```

2. **执行建表脚本**
```bash
mysql -u root -p educhain_db < database_schema.sql
```

3. **验证表结构**
```sql
USE educhain_db;
SHOW TABLES;
-- 应显示20张表
```

4. **创建应用用户**
```sql
CREATE USER 'educhain_app'@'localhost' IDENTIFIED BY 'your_password';
GRANT SELECT, INSERT, UPDATE, DELETE ON educhain_db.* TO 'educhain_app'@'localhost';
FLUSH PRIVILEGES;
```

### 11.3 备份策略

| 备份类型 | 频率 | 保留时间 | 说明 |
|----------|------|----------|------|
| 全量备份 | 每日 | 30天 | 完整数据库备份 |
| 增量备份 | 每小时 | 7天 | binlog增量备份 |
| 逻辑备份 | 每周 | 90天 | mysqldump逻辑备份 |

---

## 十二、版本历史

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|----------|--------|
| 1.0 | 2025-11-01 | 初始版本，包含基础表结构 | - |
| 2.0 | 2025-11-15 | 添加搜索、统计、成就模块 | - |
| 3.0 | 2025-11-28 | 完全匹配实体类，添加外部数据源模块 | - |

---

## 附录A：表关系矩阵

| 表名 | users | categories | knowledge_items | tags | comments | user_interactions | user_follows | notifications |
|------|-------|------------|-----------------|------|----------|-------------------|--------------|---------------|
| users | - | - | 1:N | 1:N | 1:N | 1:N | 1:N | 1:N |
| categories | - | 自关联 | 1:N | - | - | - | - | - |
| knowledge_items | N:1 | N:1 | - | - | 1:N | 1:N | - | - |
| tags | N:1 | - | - | - | - | - | - | - |
| comments | N:1 | - | N:1 | - | 自关联 | - | - | - |
| user_interactions | N:1 | - | N:1 | - | - | - | - | - |
| user_follows | N:1 | - | - | - | - | - | - | - |
| notifications | N:1 | - | - | - | - | - | - | - |

---

## 附录B：常用查询示例

### B.1 获取用户发布的知识列表

```sql
SELECT ki.*, ks.view_count, ks.like_count, ks.favorite_count, ks.comment_count
FROM knowledge_items ki
LEFT JOIN knowledge_stats ks ON ki.id = ks.knowledge_id
WHERE ki.uploader_id = ? AND ki.status = 1
ORDER BY ki.created_at DESC
LIMIT 10 OFFSET 0;
```

### B.2 获取知识详情及统计

```sql
SELECT 
    ki.*,
    u.username AS uploader_name,
    u.avatar_url AS uploader_avatar,
    c.name AS category_name,
    ks.view_count,
    ks.like_count,
    ks.favorite_count,
    ks.comment_count
FROM knowledge_items ki
JOIN users u ON ki.uploader_id = u.id
JOIN categories c ON ki.category_id = c.id
LEFT JOIN knowledge_stats ks ON ki.id = ks.knowledge_id
WHERE ki.share_code = ?;
```

### B.3 获取用户的收藏列表

```sql
SELECT ki.*, ks.view_count, ks.like_count
FROM user_interactions ui
JOIN knowledge_items ki ON ui.knowledge_id = ki.id
LEFT JOIN knowledge_stats ks ON ki.id = ks.knowledge_id
WHERE ui.user_id = ? AND ui.interaction_type = 'FAVORITE' AND ki.status = 1
ORDER BY ui.created_at DESC;
```

### B.4 获取热门知识排行

```sql
SELECT ki.*, ks.view_count, ks.like_count, ks.favorite_count,
       (ks.view_count * 0.1 + ks.like_count * 0.5 + ks.favorite_count * 0.4) AS hot_score
FROM knowledge_items ki
JOIN knowledge_stats ks ON ki.id = ks.knowledge_id
WHERE ki.status = 1
ORDER BY hot_score DESC
LIMIT 10;
```

### B.5 获取分类树结构

```sql
WITH RECURSIVE category_tree AS (
    SELECT id, name, description, parent_id, sort_order, 0 AS level
    FROM categories
    WHERE parent_id IS NULL
    UNION ALL
    SELECT c.id, c.name, c.description, c.parent_id, c.sort_order, ct.level + 1
    FROM categories c
    JOIN category_tree ct ON c.parent_id = ct.id
)
SELECT * FROM category_tree ORDER BY level, sort_order;
```

---

## 附录C：数据库配置建议

### C.1 MySQL配置优化（my.cnf）

```ini
[mysqld]
# 基础配置
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
default-storage-engine = InnoDB

# InnoDB配置
innodb_buffer_pool_size = 4G
innodb_log_file_size = 256M
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT

# 连接配置
max_connections = 500
wait_timeout = 28800
interactive_timeout = 28800

# 查询缓存（MySQL 8.0已移除）
# query_cache_type = 1
# query_cache_size = 128M

# 慢查询日志
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
```

---

**文档结束**

*本文档为基于区块链存证的教育知识共享与智能检索系统（EduChain）数据库设计文档，详细描述了系统的数据库架构、表结构、关系设计、索引优化等内容，可作为毕业设计的数据库设计说明书使用。*
